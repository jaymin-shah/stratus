System.register(["lodash","stratus","stratus.services.model","stratus.services.collection","@stratusjs/core/conversion","@stratusjs/core/misc"],(function(t,e){"use strict";var o,i,a,r,n,c,l,s;e&&e.id;return{setters:[function(t){o=t},function(t){i=t},function(t){a=t},function(t){r=t},function(t){n=t},function(t){c=t}],execute:function(){l=(t,e,o,i)=>t=>{console.error("$interpolate not loaded:",t)},t("Registry",s=class{constructor(){this.fetch=this.fetch.bind(this)}fetch(t,e){return new Promise((a,r)=>{"string"==typeof t&&(t={target:t});const s=o.each({target:"data-target",targetSuffix:"data-target-suffix",id:"data-id",manifest:"data-manifest",decouple:"data-decouple",direct:"data-direct",api:"data-api",urlRoot:"data-url-root"},(e,o,i)=>{i[o]=t.attr?t.attr(e):t[o],c.isJSON(i[o])&&(i[o]=JSON.parse(i[o]))});s.api=n.sanitize(s.api);let u=0;const g=()=>{o.isNumber(u)&&u===o.size(s)&&a(this.build(s,e))};o.each(s,(t,o)=>{if(!t||"string"!=typeof t)return u++,void g();const a=l(t,!1,null,!0),r=a(e.$parent);if(void 0!==r)return s[o]=r,u++,void g();i.Environment.get("production")||console.log("poll attribute:",o),c.poll(()=>a(e.$parent),7500,250).then(t=>{i.Environment.get("production")||console.log("interpreted:",t),void 0!==t&&(s[o]=t,u++,g())}).catch(t=>{console.error(t)})})})}build(t,e){let o;if(t.target){if(t.target=c.ucfirst(t.target),t.manifest||t.id){i.Catalog[t.target]||(i.Catalog[t.target]={});const e=t.id||"manifest";if(t.decouple||!i.Catalog[t.target][e]){const r={target:t.target,manifest:t.manifest,stagger:!0};t.urlRoot&&(r.urlRoot=t.urlRoot),t.targetSuffix&&(r.targetSuffix=t.targetSuffix),o=new a.Model(r,{id:t.id}),t.decouple||(i.Catalog[t.target][e]=o)}else i.Catalog[t.target][e]&&(o=i.Catalog[t.target][e])}else{const e=t.direct?"Compendium":"Catalog";if(i[e][t.target]||(i[e][t.target]={}),t.decouple||!i[e][t.target].collection){const a={target:t.target,direct:!!t.direct};t.urlRoot&&(a.urlRoot=t.urlRoot),t.targetSuffix&&(a.targetSuffix=t.targetSuffix),o=new r.Collection(a),t.decouple||(i[e][t.target].collection=o)}else i[e][t.target].collection&&(o=i[e][t.target].collection)}t.api&&o.meta.set("api",c.isJSON(t.api)?JSON.parse(t.api):t.api),o.stagger&&"function"==typeof o.initialize&&o.initialize()}return"object"==typeof o&&null!==o&&(void 0!==e&&(e.data=o,o instanceof a.Model?(e.model=o,"function"==typeof e.$applyAsync&&e.model.on("change",()=>{e.$applyAsync()})):o instanceof r.Collection&&(e.collection=o)),o.pending||o.completed||o.fetch()),o}}),i.Services.Registry=["$provide",t=>{t.factory("Registry",["$interpolate","Collection","Model",(t,e,o)=>(l=t,new s)])}],i.Data.Registry=s}}}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAiXSwibmFtZXMiOlsiU3lzdGVtIiwicmVnaXN0ZXIiLCJleHBvcnRzXzEiLCJjb250ZXh0XzEiLCJfIiwiU3RyYXR1cyIsInN0cmF0dXNfc2VydmljZXNfbW9kZWxfMSIsInN0cmF0dXNfc2VydmljZXNfY29sbGVjdGlvbl8xIiwiY29udmVyc2lvbl8xIiwibWlzY18xIiwiaW50ZXJwb2xhdGUiLCJSZWdpc3RyeSIsImlkIiwic2V0dGVycyIsIl8xIiwiU3RyYXR1c18xIiwic3RyYXR1c19zZXJ2aWNlc19tb2RlbF8xXzEiLCJzdHJhdHVzX3NlcnZpY2VzX2NvbGxlY3Rpb25fMV8xIiwiY29udmVyc2lvbl8xXzEiLCJtaXNjXzFfMSIsImV4ZWN1dGUiLCJ2YWx1ZSIsIm11c3RIYXZlRXhwcmVzc2lvbiIsInRydXN0ZWRDb250ZXh0IiwiYWxsT3JOb3RoaW5nIiwiZGF0YSIsImNvbnNvbGUiLCJlcnJvciIsIltvYmplY3QgT2JqZWN0XSIsInRoaXMiLCJmZXRjaCIsImJpbmQiLCIkZWxlbWVudCIsIiRzY29wZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwidGFyZ2V0Iiwib3B0aW9ucyIsImVhY2giLCJ0YXJnZXRTdWZmaXgiLCJtYW5pZmVzdCIsImRlY291cGxlIiwiZGlyZWN0IiwiYXBpIiwidXJsUm9vdCIsImtleSIsImxpc3QiLCJhdHRyIiwiaXNKU09OIiwiSlNPTiIsInBhcnNlIiwic2FuaXRpemUiLCJjb21wbGV0ZWQiLCJ2ZXJpZnkiLCJpc051bWJlciIsInNpemUiLCJidWlsZCIsImVsZW1lbnQiLCJpbnRlcnByZXRlciIsImluaXRpYWwiLCIkcGFyZW50IiwiRW52aXJvbm1lbnQiLCJnZXQiLCJsb2ciLCJwb2xsIiwidGhlbiIsImNhdGNoIiwibWVzc2FnZSIsInVjZmlyc3QiLCJDYXRhbG9nIiwibW9kZWxPcHRpb25zIiwic3RhZ2dlciIsIk1vZGVsIiwicmVnaXN0cnkiLCJjb2xsZWN0aW9uIiwiY29sbGVjdGlvbk9wdGlvbnMiLCJDb2xsZWN0aW9uIiwibWV0YSIsInNldCIsImluaXRpYWxpemUiLCJtb2RlbCIsIiRhcHBseUFzeW5jIiwib24iLCJwZW5kaW5nIiwiU2VydmljZXMiLCIkcHJvdmlkZSIsImZhY3RvcnkiLCIkaW50ZXJwb2xhdGUiLCJEYXRhIl0sIm1hcHBpbmdzIjoiQUFBQUEsT0FBT0MsU0FBUyxDQUFDLFNBQVUsVUFBVyx5QkFBMEIsOEJBQStCLDZCQUE4Qix5QkFBeUIsU0FBVUMsRUFBV0MsR0FDekssYUFFQSxJQUFJQyxFQUFHQyxFQUFTQyxFQUEwQkMsRUFBK0JDLEVBQWNDLEVBQVFDLEVBQWFDLEVBRXpGUixHQUFhQSxFQUFVUyxHQUUxQyxNQUFPLENBQ0xDLFFBQVMsQ0FBQyxTQUFVQyxHQUNsQlYsRUFBSVUsR0FDSCxTQUFVQyxHQUNYVixFQUFVVSxHQUNULFNBQVVDLEdBQ1hWLEVBQTJCVSxHQUMxQixTQUFVQyxHQUNYVixFQUFnQ1UsR0FDL0IsU0FBVUMsR0FDWFYsRUFBZVUsR0FDZCxTQUFVQyxHQUNYVixFQUFTVSxJQUVYQyxRQUFTLFdBQ1BWLEVBQWMsQ0FBQ1csRUFBT0MsRUFBb0JDLEVBQWdCQyxJQUNqREMsSUFDTEMsUUFBUUMsTUFBTSwyQkFBNEJGLElBaU05Q3ZCLEVBQVUsV0E3TFZTLEVBQVcsTUFDVGlCLGNBQ0VDLEtBQUtDLE1BQVFELEtBQUtDLE1BQU1DLEtBQUtGLE1BRy9CRCxNQUFNSSxFQUFVQyxHQUNkLE9BQU8sSUFBSUMsUUFBUSxDQUFDQyxFQUFTQyxLQUNILGlCQUFiSixJQUNUQSxFQUFXLENBQ1RLLE9BQVFMLElBSVosTUFXTU0sRUFBVWxDLEVBQUVtQyxLQVhILENBQ2JGLE9BQVEsY0FDUkcsYUFBYyxxQkFDZDVCLEdBQUksVUFDSjZCLFNBQVUsZ0JBQ1ZDLFNBQVUsZ0JBQ1ZDLE9BQVEsY0FDUkMsSUFBSyxXQUNMQyxRQUFTLGlCQUdvQixDQUFDeEIsRUFBT3lCLEVBQUtDLEtBQzFDQSxFQUFLRCxHQUFPZCxFQUFTZ0IsS0FBT2hCLEVBQVNnQixLQUFLM0IsR0FBU1cs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