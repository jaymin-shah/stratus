!function(t,e){"function"==typeof define&&define.amd?define(["exports","stratus","lodash","angular","stratus.services.collection","stratus.services.model"],e):e(t.exports,t.Stratus,t._,t.angular,t.Collection,t.Model)}(this,(function(t,e,a,o,r,i){let n=function(){console.error("$$interpolate not loaded:",arguments)};class c{constructor(){this.fetch=this.fetch.bind(this)}fetch(t,o){return new Promise((function(r,i){"string"==typeof t&&(t={target:t});const l={target:t.attr?t.attr("data-target"):t.target,targetSuffix:t.attr?t.attr("data-target-suffix"):t.targetSuffix,id:t.attr?t.attr("data-id"):t.id,manifest:t.attr?t.attr("data-manifest"):t.manifest,decouple:t.attr?t.attr("data-decouple"):t.decouple,direct:t.attr?t.attr("data-direct"):t.direct,api:t.attr?t.attr("data-api"):t.api,urlRoot:t.attr?t.attr("data-url-root"):t.urlRoot};let u=0;const f=function(){a.isNumber(u)&&u===a.size(l)&&r(c.build(l,o))};a.each(l,(function(t,r){if(!t||"string"!=typeof t)return u++,void f();const i=n(t,!1,null,!0),c=i(o.$parent);if(void 0!==c)return l[r]=c,u++,void f();e.Environment.get("production")||console.log("poll attribute:",r),a.poll((function(){return i(o.$parent)}),7500,250).then((function(t){e.Environment.get("production")||console.log("interpreted:",t),void 0!==t&&(l[r]=t,u++,f())})).catch((function(t){console.error(t)}))}))}))}static build(t,o){let n;if(t.target){if(t.target=a.ucfirst(t.target),t.manifest||t.id){e.Catalog[t.target]||(e.Catalog[t.target]={});const a=t.id||"manifest";if(t.decouple||!e.Catalog[t.target][a]){const o={target:t.target,manifest:t.manifest,stagger:!0};t.urlRoot&&(o.urlRoot=t.urlRoot),t.targetSuffix&&(o.targetSuffix=t.targetSuffix),n=new i(o,{id:t.id}),t.decouple||(e.Catalog[t.target][a]=n)}else e.Catalog[t.target][a]&&(n=e.Catalog[t.target][a])}else{const a=t.direct?"Compendium":"Catalog";if(e[a][t.target]||(e[a][t.target]={}),t.decouple||!e[a][t.target].collection){const o={target:t.target,direct:!!t.direct};t.urlRoot&&(o.urlRoot=t.urlRoot),t.targetSuffix&&(o.targetSuffix=t.targetSuffix),n=new r(o),t.decouple||(e[a][t.target].collection=n)}else e[a][t.target].collection&&(n=e[a][t.target].collection)}t.api&&n.meta.set("api",a.isJSON(t.api)?JSON.parse(t.api):t.api),n.stagger&&"function"==typeof n.initialize&&n.initialize()}return"object"==typeof n&&null!==n&&(void 0!==o&&(o.data=n,n instanceof i?(o.model=n,"function"==typeof o.$applyAsync&&o.model.on("change",(function(){o.$applyAsync()}))):n instanceof r&&(o.collection=n)),n.pending||n.completed||n.fetch()),n}}return e.Services.Registry=["$provide",function(t){t.factory("Registry",["$interpolate","Collection","Model",function(t,e,a){return n=t,new c}])}],e.Data.Registry=c,c,c}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJleHBvcnRzIiwiU3RyYXR1cyIsIl8iLCJhbmd1bGFyIiwiQ29sbGVjdGlvbiIsIk1vZGVsIiwidGhpcyIsIiQkaW50ZXJwb2xhdGUiLCJjb25zb2xlIiwiZXJyb3IiLCJhcmd1bWVudHMiLCJSZWdpc3RyeSIsIltvYmplY3QgT2JqZWN0XSIsImZldGNoIiwiYmluZCIsIiRlbGVtZW50IiwiJHNjb3BlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJ0YXJnZXQiLCJvcHRpb25zIiwiYXR0ciIsInRhcmdldFN1ZmZpeCIsImlkIiwibWFuaWZlc3QiLCJkZWNvdXBsZSIsImRpcmVjdCIsImFwaSIsInVybFJvb3QiLCJjb21wbGV0ZWQiLCJ2ZXJpZnkiLCJpc051bWJlciIsInNpemUiLCJidWlsZCIsImVhY2giLCJlbGVtZW50Iiwia2V5IiwiaW50ZXJwcmV0ZXIiLCJpbml0aWFsIiwiJHBhcmVudCIsIkVudmlyb25tZW50IiwiZ2V0IiwibG9nIiwicG9sbCIsInRoZW4iLCJ2YWx1ZSIsImNhdGNoIiwibWVzc2FnZSIsImRhdGEiLCJ1Y2ZpcnN0IiwiQ2F0YWxvZyIsIm1vZGVsT3B0aW9ucyIsInN0YWdnZXIiLCJyZWdpc3RyeSIsImNvbGxlY3Rpb24iLCJjb2xsZWN0aW9uT3B0aW9ucyIsIm1ldGEiLCJzZXQiLCJpc0pTT04iLCJKU09OIiwicGFyc2UiLCJpbml0aWFsaXplIiwibW9kZWwiLCIkYXBwbHlBc3luYyIsIm9uIiwicGVuZGluZyIsIlNlcnZpY2VzIiwiJHByb3ZpZGUiLCIkaW50ZXJwb2xhdGUiLCJEYXRhIl0sIm1hcHBpbmdzIjoiQ0FLQSxTQUFXQSxFQUFNQyxHQUNPLG1CQUFYQyxRQUF5QkEsT0FBT0MsSUFDekNELE9BQU8sQ0FBQyxVQUFXLFVBQVcsU0FBVSxVQUFXLDhCQUErQiwwQkFBMkJELEdBRTdHQSxFQUFRRCxFQUFLSSxRQUFTSixFQUFLSyxR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