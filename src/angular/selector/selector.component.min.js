System.register(["@angular/core","@angular/forms","@angular/cdk/drag-drop","rxjs","@angular/platform-browser","@angular/material/icon","stratus","lodash"],function(t,e){"use strict";var n,i,r,s,o,a,c,h,u,d,l=this&&this.__decorate||function(t,e,n,i){var r,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(s<3?r(o):s>3?r(e,n,o):r(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o},f=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},g=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(o,a)}c((i=i.apply(t,e||[])).next())})};e&&e.id;return{setters:[function(t){n=t},function(t){i=t},function(t){r=t},function(t){s=t},function(t){o=t},function(t){a=t},function(t){c=t},function(t){h=t}],execute:function(){u="/assets/1/0/bundles/sitetheorystratus/stratus/src/angular","@stratus/angular","selector",d=class{constructor(t,e,n){this.ref=n,this.title="selector-dnd",this.selectCtrl=new i.FormControl,this.registry=new c.Data.Registry,this.onChange=new s.Subject,this.uid=h.uniqueId("sa_selector_component_"),c.Instances[this.uid]=this;const r=this;this._=h,this.sanitizer=e,t.addSvgIcon("delete",e.bypassSecurityTrustResourceUrl("/Api/Resource?path=@SitetheoryCoreBundle:images/icons/actionButtons/delete.svg")),c.Internals.CssLoader(`${u}/selector/selector.component.css`),console.log("inputs:",this.target,this.id,this.manifest,this.api),h.isUndefined(this.target)&&(this.target="Content"),this.dataSub=new s.Observable(t=>this.dataDefer(t)),this.fetchData().then(t=>{t.on?(t.on("change",()=>{r.dataDefer(r.subscriber),n.detectChanges()}),r.dataDefer(r.subscriber),n.detectChanges()):console.warn("Unable to bind data from Registry!")})}drop(t){const e=this.dataRef();if(!e||!e.length)return;r.moveItemInArray(e,t.previousIndex,t.currentIndex);let n=0;h.each(e,t=>t.priority=n++),this.model.trigger("change")}remove(t){const e=this.dataRef();if(!e||!e.length)return;const n=e.indexOf(t);-1!==n&&(e.splice(n,1),this.model.trigger("change"))}fetchData(){return g(this,void 0,void 0,function*(){return this.fetched||(this.fetched=this.registry.fetch(c.Select("#widget-edit-entity"),this)),this.fetched})}dataDefer(t){this.subscriber=t;const e=this.dataRef();e&&e.length?(console.log("pushed models to subscriber."),t.next(e)):setTimeout(()=>{this.dataDefer(t)},500)}dataRef(){if(!this.model)return[];const t=h.get(this.model,"data.version.modules");return t&&h.isArray(t)?t:[]}onDataChange(t){this.dataDefer(this.subscriber),t.detectChanges()}prioritize(){const t=this.dataRef();if(!t||!t.length)return;let e=0;h.each(t,t=>t.priority=e++)}findImage(t){const e=h.get(t,"version.images[0].mime");return void 0===e?"":-1!==e.indexOf("image")?h.get(t,"version.images[0].src"):-1!==e.indexOf("video")?h.get(t,"version.images[0].meta.thumbnail_small"):""}},l([n.Input(),f("design:type",String)],d.prototype,"target",void 0),l([n.Input(),f("design:type",Number)],d.prototype,"id",void 0),l([n.Input(),f("design:type",Boolean)],d.prototype,"manifest",void 0),l([n.Input(),f("design:type",Object)],d.prototype,"api",void 0),l([n.Input(),f("design:type",Object)],d.prototype,"searchQuery",void 0),d=l([n.Component({selector:"sa-selector",templateUrl:`${u}/selector/selector.component.html`,changeDetection:n.ChangeDetectionStrategy.OnPush}),f("design:paramtypes",[a.MatIconRegistry,o.DomSanitizer,n.ChangeDetectorRef])],d),t("SelectorComponent",d)}}});