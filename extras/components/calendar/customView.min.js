(function(root,factory){if(typeof define==="function"&&define.amd){define(["exports","stratus","underscore","@fullcalendar/core","angular-material","moment-range"],factory)}else{factory({},root.Stratus,root._,root.FullCalendar)}})(this,function(exports,Stratus,_,fullcalendarCore){const min=Stratus.Environment.get("production")?".min":"";const name="customView";const localPath="extras/components/calendar";const defaultTemplate="default";let uid=null;Stratus.Components.CalendarCustomView={bindings:{template:"@"},controller:function($scope,$attrs){const $ctrl=this;if(!uid){uid=_.uniqueId(_.camelToSnake(name)+"_")}$ctrl.uid=uid;Stratus.Instances[$ctrl.uid]=$scope;$scope.elementId=$ctrl.uid;$scope.template=$attrs.template&&!_.isEmpty($attrs.template)?$attrs.template:defaultTemplate;Stratus.Internals.CssLoader(`${Stratus.BaseUrl}${Stratus.BundlePath}${localPath}/${name}.${$scope.template}${min}.css`);$scope.events=[];$scope.$applyAsync(function(){$scope.$parent.customViews[uid]=$scope.template});$ctrl.$onInit=function(){};$scope.eventClick=async function(eventData,ev){$scope.$parent.calendar.publiclyTrigger("eventClick",[{el:ev.target||null,event:eventData,jsEvent:ev,view:$scope.view}]);return false};$scope.destroy=function(){delete $scope.$parent.customViews[uid];if(typeof Stratus.Instances[uid].remove==="function"){Stratus.Instances[uid].remove()}$scope.$destroy();delete Stratus.Instances[uid]}},templateUrl:function($element,$attrs){return`${Stratus.BaseUrl}${Stratus.BundlePath}${localPath}/${name}.${$attrs.template||defaultTemplate}${min}.html`}};class CustomView extends fullcalendarCore.View{initialize(){uid=_.uniqueId(_.camelToSnake(name)+"_");this.$parentScope=this.viewSpec.options.$scope;let calendarCustomViewComponent=this.viewSpec.options.$compile(`<stratus-calendar-custom-view data-template="${this.viewSpec.options.template}"></stratus-calendar-custom-view>`);this.componentEl=calendarCustomViewComponent(this.$parentScope);let that=this;let stopWatchingScope=this.$parentScope.$watch(`customViews`,function(){if(that.$parentScope.customViews.hasOwnProperty(uid)&&Stratus.Instances.hasOwnProperty(uid)){that.$scope=Stratus.Instances[uid];that.$scope.options=that.viewSpec.options;that.$scope.view=that;if(that.eventsWaiting){that.updateEventScope(that.eventsWaiting)}stopWatchingScope()}},true);fullcalendarCore.appendToElement(this.el,this.componentEl)}destroy(){super.destroy();this.$scope.destroy()}renderEvents(eventStore,eventUiHash){if(this.$scope){let that=this;this.updateEventScope(that.getEventsInRange(eventStore))}else{this.eventsWaiting=this.getEventsInRange(eventStore)}}updateEventScope(events){let that=this;that.$scope.$applyAsync(function(){that.$scope.events.length=0;that.$scope.events.push(...events)})}getEventsInRange(eventStore,eventUiBases){let that=this;eventStore=eventStore||this.props.eventStore;eventUiBases=eventUiBases||this.props.eventUiBases;let events=[];let sliceEventObjects=fullcalendarCore.sliceEventStore(eventStore,eventUiBases,that.props.dateProfile.activeRange,that.nextDayThreshold);if(sliceEventObjects.hasOwnProperty("fg")&&_.isArray(sliceEventObjects.fg)){sliceEventObjects.fg.forEach(function(eventRaw){let event=new fullcalendarCore.EventApi(that.$parentScope.calendar,eventRaw.def,eventRaw.instance);if(event&&!event.descriptionHTML&&event.constructor.prototype.hasOwnProperty("extendedProps")&&event.extendedProps.hasOwnProperty("description")){event.descriptionHTML=that.viewSpec.options.$sce.trustAsHtml(event.extendedProps.description)}events.push(event)})}return events}}exports.CustomView=CustomView;exports.default=fullcalendarCore.createPlugin({defaultView:"custom",views:{custom:{class:CustomView,template:"default",duration:{month:1}},customArticle:{type:"custom",template:"article"},customArticleDay:{type:"customArticle",duration:{day:1}},customArticleWeek:{type:"customArticle",duration:{week:1}},customArticleMonth:{type:"customArticle",duration:{month:1}},customArticleYear:{type:"customArticle",duration:{year:1}}}});Object.defineProperty(exports,"__esModule",{value:true})});