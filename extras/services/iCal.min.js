!function(t,e){"function"==typeof define&&define.amd?define(["stratus","ical"],e):e(t.Stratus)}(this,(function(t,e,n){t.Services.iCal=["$provide",function(t){t.factory("iCal",[function(){const t=function(t,e){e=e||{},this.maxIterations=null!=e.maxIterations?e.maxIterations:1e3,this.skipInvalidDates=null!=e.skipInvalidDates&&e.skipInvalidDates,this.jCalData=ICAL.parse(t),this.component=new ICAL.Component(this.jCalData),this.events=this.component.getAllSubcomponents("vevent").map(t=>new ICAL.Event(t)),this.skipInvalidDates&&(this.events=this.events.filter(t=>{try{return t.startDate.toJSDate(),t.endDate.toJSDate(),!0}catch(t){return!1}}))};return t.prototype.between=function(t,e){const n=function(n,r){return(!t||r>=t.getTime())&&(!e||n<=e.getTime())},r=function(t){const e=t.startDate.toJSDate().getTime();let n=t.endDate.toJSDate().getTime();return t.endDate.isDate&&n>e&&(n-=1),{startTime:e,endTime:n}},a=[];this.events.forEach(t=>{t.isRecurrenceException()&&a.push(t)});const i={events:[],occurrences:[]};return this.events.filter(t=>!t.isRecurrenceException()).forEach(t=>{const o=[];if(t.component.getAllProperties("exdate").forEach(t=>{const e=t.getFirstValue();o.push(e.toJSDate().getTime())}),t.isRecurring()){const s=t.iterator();let c,u=0;do{if(u+=1,c=s.next()){const s=t.getOccurrenceDetails(c),{startTime:u,endTime:l}=r(s),m=-1!==o.indexOf(u),p=a.find(e=>e.uid===t.uid&&e.recurrenceId.toJSDate().getTime()===s.startDate.toJSDate().getTime());if(e&&u>e.getTime())break;n(u,l)&&(p?i.events.push(p):m||i.occurrences.push(s))}}while(c&&(!this.maxIterations||u<this.maxIterations));return}const{startTime:s,endTime:c}=r(t);n(s,c)&&i.events.push(t)}),i},t.prototype.before=function(t){return this.between(void 0,t)},t.prototype.after=function(t){return this.between(t)},t.prototype.all=function(){return this.between()},t.prototype.flattenRecurringEvent=function(t){const e=this.flattenEvent(t.item);return e.recurrenceId=t.recurrenceId.toJSDate(),e.startDate=t.startDate.toJSDate(),e.endDate=t.endDate.toJSDate(),e},t.prototype.flattenEvent=function(t){return{startDate:t.startDate.toJSDate(),endDate:t.endDate.toJSDate(),description:t.description,title:t.summary,summary:t.summary,attendees:t.attendees,organizer:t.organizer,sequence:t.sequence,uid:t.uid,location:t.location,url:t.url,allDay:t.allDay,image:t.image}},t.prototype.jsonEvents=function(t,e){let n;const r=(n=t&&e?this.between(t,e):this.all()).events.map(t=>this.flattenEvent(t)),a=n.occurrences.map(t=>this.flattenRecurringEvent(t));return[].concat(r,a)},t.prototype.flattenRecurringEventForFullCalendar=function(t){const e=this.flattenEventForFullCalendar(t.item);return e.start=t.startDate.toJSDate(),e.end=t.endDate.toJSDate(),e},t.prototype.flattenEventForFullCalendar=function(t){return{start:t.startDate.toJSDate(),end:t.endDate.toJSDate(),title:t.summary,summary:t.summary,description:t.description,attendees:t.attendees,organizer:t.organizer,id:t.uid,location:t.location,url:t.url,allDay:t.allDay,image:t.image}},t.prototype.jsonEventsForFullCalendar=function(t,e){let n;const r=(n=t&&e?this.between(t,e):this.all()).events.map(t=>this.flattenEventForFullCalendar(t)),a=n.occurrences.map(t=>this.flattenRecurringEventForFullCalendar(t));return[].concat(r,a)},{ICalExpander:t,registerTimezones:function(t){Object.keys(t).forEach(e=>{const n=t[e],r=ICAL.parse(`BEGIN:VCALENDAR\nPRODID:-//tzurl.org//NONSGML Olson 2012h//EN\nVERSION:2.0\n${n}\nEND:VCALENDAR`),a=new ICAL.Component(r).getFirstSubcomponent("vtimezone");ICAL.TimezoneService.register(a)})}}}])}]}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJTdHJhdHVzIiwidGhpcyIsIl8iLCJhbmd1bGFyIiwiU2VydmljZXMiLCJpQ2FsIiwiJHByb3ZpZGUiLCJJQ2FsRXhwYW5kZXIiLCJpY3NEYXRhIiwib3B0cyIsIm1heEl0ZXJhdGlvbnMiLCJza2lwSW52YWxpZERhdGVzIiwiakNhbERhdGEiLCJJQ0FMIiwicGFyc2UiLCJjb21wb25lbnQiLCJDb21wb25lbnQiLCJldmVudHMiLCJnZXRBbGxTdWJjb21wb25lbnRzIiwibWFwIiwidmV2ZW50IiwiRXZlbnQiLCJmaWx0ZXIiLCJldnQiLCJzdGFydERhdGUiLCJ0b0pTRGF0ZSIsImVuZERhdGUiLCJlcnIiLCJwcm90b3R5cGUiLCJiZXR3ZWVuIiwiYWZ0ZXIiLCJiZWZvcmUiLCJpc0V2ZW50V2l0aGluUmFuZ2UiLCJzdGFydFRpbWUiLCJlbmRUaW1lIiwiZ2V0VGltZSIsImdldFRpbWVzIiwiZXZlbnRPck9jY3VycmVuY2UiLCJpc0RhdGUiLCJleGNlcHRpb25zIiwiZm9yRWFjaCIsImV2ZW50IiwiaXNSZWN1cnJlbmNlRXhjZXB0aW9uIiwicHVzaCIsInJldCIsIm9jY3VycmVuY2VzIiwiZSIsImV4RGF0ZXMiLCJnZXRBbGxQcm9wZXJ0aWVzIiwiZXhEYXRlUHJvcCIsImV4RGF0ZSIsImdldEZpcnN0VmFsdWUiLCJpc1JlY3VycmluZyIsIml0ZXJhdG9yIiwibmV4dCIsImkiLCJvY2N1cnJlbmNlIiwiZ2V0T2NjdXJyZW5jZURldGFpbHMiLCJpc09jY3VycmVuY2VFeGNsdWRlZCIsImluZGV4T2YiLCJleGNlcHRpb24iLCJmaW5kIiwiZXgiLCJ1aWQiLCJyZWN1cnJlbmNlSWQiLCJ1bmRlZmluZWQiLCJhbGwiLCJmbGF0dGVuUmVjdXJyaW5nRXZlbnQiLCJmbGF0dGVuRXZlbnQiLCJpdGVtIiwiZGVzY3JpcHRpb24iLCJ0aXRsZSIsInN1bW1hcnkiLCJhdHRlbmRlZXMiLCJvcmdhbml6ZXIiLCJzZXF1ZW5jZSIsImxvY2F0aW9uIiwidXJsIiwiYWxsRGF5IiwiaW1hZ2UiLCJqc29uRXZlbnRzIiwic3RhcnRSYW5nZSIsImVuZFJhbmdlIiwibWFwcGVkRXZlbnRzIiwibyIsIm1hcHBlZE9jY3VycmVuY2VzIiwiY29uY2F0IiwiZmxhdHRlblJlY3VycmluZ0V2ZW50Rm9yRnVsbENhbGVuZGFyIiwiZmxhdHRlbkV2ZW50Rm9yRnVsbENhbGVuZGFyIiwic3RhcnQiLCJlbmQiLCJpZCIsImpzb25FdmVudHNGb3JGdWxsQ2FsZW5kYXIiLCJyZWdpc3RlclRpbWV6b25lcyIsInR6RGF0YSIsIk9iamVjdCIsImtleXMiLCJrZXkiLCJwYXJzZWQiLCJ2VGltZXpvbmUiLCJnZXRGaXJzdFN1YmNvbXBvbmVudCIsIlRpbWV6b25lU2VydmljZSIsInJlZ2lzdGVyIl0sIm1hcHBpbmdzIjoiQ0FLQSxTQUFXQSxFQUFNQyxHQUNPLG1CQUFYQyxRQUF5QkEsT0FBT0MsSUFDekNELE9BQU8sQ0FBQyxVQUFXLFFBQ2hCRCxHQUVIQSxFQUFRRCxFQUFLSSxTQUxqQixDQU9HQyxNQUFNLFNBQVVELEVBQVNFLEVBQUdDLEdBRzdCSCxFQUFRSSxTQUFTQyxLQUFPLENBQUMsV0FBWSxTQUFVQyxHQUM3Q0EsRUFBU1QsUUFBUSxPQUFRLENBQUMsV0FleEIsTUFBTVUsRUFBZSxTQUFVQyxFQUFTQyxHQUN0Q0EsRUFBT0EsR0FBUSxHQUNmUixLQUFLUyxjQUFzQyxNQUF0QkQsRUFBS0MsY0FBd0JELEVBQUtDLGNBQWdCLElBQ3ZFVCxLQUFLVSxpQkFBNEMsTUFBekJGLEVBQUtFLGtCQUEyQkYsRUFBS0UsaUJBQzdEVixLQUFLVyxTQUFXQyxLQUFLQyxNQUFNTixHQUMzQlAsS0FBS2MsVUFBWSxJQUFJRixLQUFLRyxVQUFVZixLQUFLVyxVQUN6Q1gsS0FBS2dCLE9BQVNoQixLQUFLYyxVQUFVRyxvQkFBb0IsVUFBVUMsSUFBSUMsR0FBVSxJQUFJUCxLQUFLUSxNQUFNRCxJQUVwRm5CLEtBQUtVLG1CQUNQVixL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