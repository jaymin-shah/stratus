!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","redactor"],factory):factory(root.Stratus,root._,root.angular)}(this,function(Stratus,_,angular){let redactorOptions={};angular.module("angular-redactor",[]).constant("redactorOptions",redactorOptions).directive("redactor",["$timeout",function($timeout){return _.forEach([Stratus.BaseUrl+"sitetheorycore/dist/redactor/redactor.css",Stratus.BaseUrl+"sitetheorycore/dist/redactor/redactor-clips.css",Stratus.BaseUrl+Stratus.BundlePath+"node_modules/codemirror/lib/codemirror.css"],function(url){Stratus.Internals.CssLoader(url)}),{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModel){scope.redactorLoaded=!1;let editor,updateModel=function(value){$timeout(function(){scope.$apply(function(){ngModel.$setViewValue(value)})})},options={changeCallback:updateModel},additionalOptions=attrs.redactor?scope.$eval(attrs.redactor):{};angular.extend(options,redactorOptions,additionalOptions);let changeCallback=additionalOptions.changeCallback||redactorOptions.changeCallback;changeCallback&&(options.changeCallback=function(value){updateModel.call(this,value),changeCallback.call(this,value)}),$timeout(function(){editor=element.redactor(options),ngModel.$render(),element.on("remove",function(){element.off("remove"),element.redactor("core.destroy")})}),ngModel.$render=function(){angular.isDefined(editor)&&$timeout(function(){element.redactor("code.set",ngModel.$viewValue||""),element.redactor("placeholder.toggle"),scope.redactorLoaded=!0})}}}}])});