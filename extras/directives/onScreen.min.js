!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","lodash","jquery","angular"],factory):factory(root.Stratus,root._,root.jQuery,root.angular)}(this,(function(Stratus,_,jQuery,angular){Stratus.Directives.OnScreen=function(){return{restrict:"A",scope:{onScreen:"@onScreen",stratusOnScreen:"@stratusOnScreen",offScreen:"@offScreen",spy:"@spy",target:"@target",partial:"@partial",update:"@update",animation:"@animation",event:"@event",offset:"@offset",reset:"@reset"},link:function($scope,element,attrs){this.uid=_.uniqueId(_.camelToSnake("onScreen")+"_"),Stratus.Instances[this.uid]=$scope;const $element=element instanceof jQuery?element:jQuery(element);$scope.elementId=$element.elementId||this.uid,$scope.initialized=!1,element.uid=this.uid,Stratus.Instances[element.uid]=$scope,$scope.elementId=attrs.elementId||element.uid;const event=attrs.event?attrs.event.split(" "):[],target=attrs.target?jQuery(attrs.target):$element;let spy=attrs.spy?jQuery(attrs.spy):$element;spy.length||(spy=$element);let partial=_.hydrate(attrs.partial);"boolean"!=typeof partial&&(partial=!0);let update=_.hydrate(attrs.update);"number"!=typeof update&&(update=100);let animation=_.hydrate(attrs.animation);"number"!=typeof animation&&(animation=!1);let lastUpdate=0,isWaiting=!1,wasOnScreen=!1,wipeJob=null;const offset=_.hydrate(attrs.offset)||0,reset=_.hydrate(attrs.reset)||0,wipe=function(request){animation&&(_.isUndefined(request)?(_.isNumber(wipeJob)&&clearTimeout(wipeJob),wipeJob=setTimeout((function(){wipe(!0)}),animation)):target.removeClass("reveal conceal"))},calculate=function(){return-1!==event.indexOf("reset")&&(reset>0&&$element.offset().top<=reset||jQuery(Stratus.Environment.get("viewPort")||window).scrollTop()<=0)?(target.removeClass("on-screen off-screen scroll-up scroll-down reveal conceal"),void target.addClass("reset")):function(){if(isWaiting)return wasOnScreen;const calculation=(new Date).getTime();return calculation-lastUpdate>update?(lastUpdate=calculation,wasOnScreen=Stratus.Internals.IsOnScreen(spy,offset,partial)):(isWaiting=!0,setTimeout((function(){isWaiting=!1,calculate()}),lastUpdate+update-calculation+1)),wasOnScreen}()?(target.hasClass("on-screen")||target.addClass("on-screen on-screen-init"),target.hasClass("off-screen")&&target.removeClass("off-screen"),!attrs.onScreen||"function"!=typeof attrs.onScreen||attrs.onScreen(),!0):(target.hasClass("on-screen")&&target.removeClass("on-screen"),target.hasClass("off-screen")||target.addClass("off-screen"),!attrs.offScreen||"function"!=typeof attrs.offScreen||attrs.offScreen(),!1)};Stratus.Internals.OnScroll(),Stratus.Environment.on("change:viewPortChange",calculate),Stratus.Environment.on("change:lastScroll",(function(){const lastScroll=Stratus.Environment.get("lastScroll");"down"!==lastScroll||target.hasClass("reset")||(target.hasClass("scroll-down")||target.addClass("scroll-down"),target.hasClass("scroll-up")&&target.removeClass("scroll-up"),animation&&Stratus.Internals.IsOnScreen(spy,offset,partial)&&(target.hasClass("reveal")&&target.removeClass("reveal"),target.hasClass("conceal")||target.addClass("conceal"),wipe())),"up"===lastScroll&&(target.hasClass("scroll-up")||target.addClass("scroll-up"),target.hasClass("scroll-down")&&target.removeClass("scroll-down"),target.hasClass("reset")&&target.removeClass("reset"),animation&&(target.hasClass("reveal")||target.addClass("reveal"),target.hasClass("conceal")&&target.removeClass("conceal"),wipe()))}));let i=0;const delayed=function(){++i>8||calculate()||setTimeout(delayed,250)};delayed()}}}}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJTdHJhdHVzIiwiXyIsImpRdWVyeSIsImFuZ3VsYXIiLCJ0aGlzIiwiRGlyZWN0aXZlcyIsIk9uU2NyZWVuIiwicmVzdHJpY3QiLCJzY29wZSIsIm9uU2NyZWVuIiwic3RyYXR1c09uU2NyZWVuIiwib2ZmU2NyZWVuIiwic3B5IiwidGFyZ2V0IiwicGFydGlhbCIsInVwZGF0ZSIsImFuaW1hdGlvbiIsImV2ZW50Iiwib2Zmc2V0IiwicmVzZXQiLCJsaW5rIiwiJHNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwidWlkIiwidW5pcXVlSWQiLCJjYW1lbFRvU25ha2UiLCJJbnN0YW5jZXMiLCIkZWxlbWVudCIsImVsZW1lbnRJZCIsImluaXRpYWxpemVkIiwic3BsaXQiLCJsZW5ndGgiLCJoeWRyYXRlIiwibGFzdFVwZGF0ZSIsImlzV2FpdGluZyIsIndhc09uU2NyZWVuIiwid2lwZUpvYiIsIndpcGUiLCJyZXF1ZXN0IiwiaXNVbmRlZmluZWQiLCJpc051bWJlciIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJyZW1vdmVDbGFzcyIsImNhbGN1bGF0ZSIsImluZGV4T2YiLCJ0b3AiLCJFbnZpcm9ubWVudCIsImdldCIsIndpbmRvdyIsInNjcm9sbFRvcCIsImFkZENsYXNzIiwiY2FsY3VsYXRpb24iLCJEYXRlIiwiZ2V0VGltZSIsIkludGVybmFscyIsIklzT25TY3JlZW4iLCJpc09uU2NyZWVuIiwiaGFzQ2xhc3MiLCJPblNjcm9sbCIsIm9uIiwibGFzdFNjcm9sbCIsImkiLCJkZWxheWVkIl0sIm1hcHBpbmdzIjoiQ0FLQSxTQUFXQSxLQUFNQyxTQUNPLG1CQUFYQyxRQUF5QkEsT0FBT0MsSUFDekNELE9BQU8sQ0FBQyxVQUFXLFNBQVUsU0FBVSxXQUFZRCxTQUVuREEsUUFBUUQsS0FBS0ksUUFBU0osS0FBS0ssRUFBR0wsS0FBS00sT0FBUU4sS0FBS08sU0FKcEQsQ0FN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