!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","lodash","jquery","angular"],factory):factory(root.Stratus,root._,root.jQuery,root.angular)}(this,(function(Stratus,_,jQuery,angular){Stratus.Directives.Src=function($parse,$interpolate){return{restrict:"A",scope:{src:"@src",stratusSrc:"@stratusSrc",style:"@style"},link:function($scope,$element,$attr){Stratus.Instances[_.uniqueId("src_")]=$scope,$scope.whitelist=["jpg","jpeg","png","gif"],$scope.filter=null,$scope.$watch((function(){return $attr.stratusSrc||$attr.src||$attr.style}),(function(newVal,oldVal,scope){newVal&&$element.attr("data-size")&&($scope.registered=!1),$scope.register()})),$scope.registered=!1,$scope.register=function(){let backgroundImage=null;"img"!==$element.prop("tagName").toLowerCase()&&(backgroundImage=$element.css("background-image")||null)&&(backgroundImage=backgroundImage.slice(4,-1).replace(/"/g,""));const src=$attr.stratusSrc||$attr.src||backgroundImage;let ext=src?src.match(/\.([0-9a-z]+)(\?.*)?$/i):null;return ext&&(ext=ext[1]?ext[1].toLowerCase():null),$scope.filter=_.filter($scope.whitelist,(function(value){return ext===value})),!_.size($scope.filter)||(!!$scope.registered||($scope.registered=!0,!(!src&&!backgroundImage)&&($element.attr("data-src",src),$scope.group={method:Stratus.Internals.LoadImage,el:$element,spy:$element.data("spy")?jQuery($element.data("spy")):$element},Stratus.Internals.OnScroll(),Stratus.RegisterGroup.add("OnScroll",$scope.group),void Stratus.Internals.LoadImage($scope.group))))}}}}}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJTdHJhdHVzIiwiXyIsImpRdWVyeSIsImFuZ3VsYXIiLCJ0aGlzIiwiRGlyZWN0aXZlcyIsIlNyYyIsIiRwYXJzZSIsIiRpbnRlcnBvbGF0ZSIsInJlc3RyaWN0Iiwic2NvcGUiLCJzcmMiLCJzdHJhdHVzU3JjIiwic3R5bGUiLCJsaW5rIiwiJHNjb3BlIiwiJGVsZW1lbnQiLCIkYXR0ciIsIkluc3RhbmNlcyIsInVuaXF1ZUlkIiwid2hpdGVsaXN0IiwiZmlsdGVyIiwiJHdhdGNoIiwibmV3VmFsIiwib2xkVmFsIiwiYXR0ciIsInJlZ2lzdGVyZWQiLCJyZWdpc3RlciIsImJhY2tncm91bmRJbWFnZSIsInByb3AiLCJ0b0xvd2VyQ2FzZSIsImNzcyIsInNsaWNlIiwicmVwbGFjZSIsImV4dCIsIm1hdGNoIiwidmFsdWUiLCJzaXplIiwiZ3JvdXAiLCJtZXRob2QiLCJJbnRlcm5hbHMiLCJMb2FkSW1hZ2UiLCJlbCIsInNweSIsImRhdGEiLCJPblNjcm9sbCIsIlJlZ2lzdGVyR3JvdXAiLCJhZGQiXSwibWFwcGluZ3MiOiJDQUtBLFNBQVdBLEtBQU1DLFNBQ08sbUJBQVhDLFFBQXlCQSxPQUFPQyxJQUN6Q0QsT0FBTyxDQUFDLFVBQVcsU0FBVSxTQUFVLFdBQVlELFNBRW5EQSxRQUFRRCxLQUFLSSxRQUFTSixLQUFLSyxFQUFHTCxLQUFLTSxPQUFRTixLQUFLTyxTQUpwRCxDQU1HQyxNQUFNLFNBQVVKLFFBQVNDLEVBQUdDLE9BQVFDLFNBRXJDSCxRQUFRSyxXQUFXQyxJQUFNLFNBQVVDLE9BQVFDLGNBQ3pDLE1BQU8sQ0FDTEMsU0FBVSxJQUNWQyxNQUFPLENBQ0xDLElBQUssT0FDTEMsV0FBWSxjQUNaQyxNQUFPLFVBRVRDLEtBQU0sU0FBVUMsT0FBUUMsU0FBVUMsT0FDaENqQixRQUFRa0IsVUFBVWpCLEVBQUVrQixTQUFTLFNBQVdKLE9BQ3hDQSxPQUFPSyxVQUFZLENBQUMsTUFBTyxPQUFRLE1BQU8sT0FDMUNMLE9BQU9NLE9BQVMsS0FFaEJOLE9BQU9PLFFBQU8sV0FDWixPQUFPTCxNQUFNTCxZQUFjSyxNQUFNTixLQUFPTSxNQUFNSixTQUM3QyxTQUFVVSxPQUFRQyxPQUFRZCxPQUN2QmEsUUFBVVAsU0FBU1MsS0FBSyxlQUMxQlYsT0FBT1csWUFBYSxHQUd0QlgsT0FBT1ksY0FHVFosT0FBT1csWUFBYSxFQUVwQlgsT0FBT1ksU0FBVyxXQUVoQixJQUFJQyxnQkFBa0IsS0FFeUIsUUFBM0NaLFNBQVNhLEtBQUssV0FBV0MsZ0JBQzNCRixnQkFBa0JaLFNBQVNlLElBQUkscUJBQXVCLFFBR3BESCxnQkFBa0JBLGdCQUFnQkksTUFBTSxHQUFJLEdBQUdDLFFBQVEsS0FBTSxLQUlqRSxNQUFNdEIsSUFBTU0sTUFBTUwsWUFBY0ssTUFBTU4sS0FBT2lCLGdCQUU3QyxJQUFJTSxJQUFNdkIsSUFBTUEsSUFBSXdCLE1BQU0sMEJBQTRCLEtBV3RELE9BVElELE1BQ0ZBLElBQU1BLElBQUksR0FBS0EsSUFBSSxHQUFHSixjQUFnQixNQUl4Q2YsT0FBT00sT0FBU3BCLEVBQUVvQixPQUFPTixPQUFPSyxXQUFXLFNBQVVnQixPQUNuRCxPQUFPRixNQUFRRSxVQUdabkMsRUFBRW9DLEtBQUt0QixPQUFPTSxZQUtmTixPQUFPVyxhQUlYWCxPQUFPVyxZQUFhLEtBRWZmLE1BQVFpQixtQkFLYlosU0FBU1MsS0FBSyxXQUFZZCxLQUkxQkksT0FBT3VCLE1BQVEsQ0FDYkMsT0FBUXZDLFFBQVF3QyxVQUFVQyxVQUMxQkMsR0FBSTFCLFNBQ0oyQixJQUFLM0IsU0FBUzRCLEtBQUssT0FBUzFDLE9BQU9jLFNBQVM0QixLQUFLLFFBQVU1QixVQUU3RGhCLFFBQVF3QyxVQUFVSyxXQUNsQjdDLFFBQVE4QyxjQUFjQyxJQUFJLFdBQVloQyxPQUFPdUIsWUFDN0N0QyxRQUFRd0MsVUFBVUMsVUFBVTFCLE9BQU91QiJ9