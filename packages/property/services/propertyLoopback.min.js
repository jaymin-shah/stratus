!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","lodash","angular","stratus.services.collection"],factory):factory(root.Stratus,root._,root.angular)}(this,function(Stratus,_,angular){Stratus.Services.PropertyLoopback=["$provide",function($provide){$provide.factory("propertyLoopback",["$http","$injector","$q","$location","$window","$rootScope","Collection","Model","orderByFilter",function($http,$injector,$q,$location,$window,$rootScope,Collection,Model,orderByFilter){let refreshLoginTimer,defaultPageTitle,tokenRefreshURL="/ajax/request?class=property.token_auth&method=getToken";const instance={List:{},Search:{},Details:{},MemberList:{},MemberSearch:{},MemberDetails:{},OfficeList:{},OfficeSearch:{},OfficeDetails:{}},instanceLink={List:{},Search:{}},session={services:[],lastCreated:new Date,lastTtl:0},urlOptions={Listing:{},Search:{}};let lastQueries={whereFilter:{},pages:[],perPage:0};function tokenKeepAuth(keepAlive){return $q(async function(resolve,reject){try{session.services.length<1||session.expires<new Date?(await tokenRefresh(keepAlive),resolve()):resolve()}catch(err){console.error("error",err),reject(err)}})}function tokenRefresh(keepAlive){return $q(function(resolve,reject){$http({method:"GET",url:tokenRefreshURL}).then(function(response){"object"==typeof response&&Object.prototype.hasOwnProperty.call(response, "data")&&Object.prototype.hasOwnProperty.call(response.data, "services")&&Object.prototype.hasOwnProperty.call(response.data.services, "length")?(!function(response,keepAlive){session.services=[],response.data.services.forEach(function(service){Object.prototype.hasOwnProperty.call(service, "id")&&(session.services[service.id]=service,session.lastCreated=new Date(service.created),session.lastTtl=service.ttl,session.expires=new Date(session.lastCreated.getTime()+1e3*(session.lastTtl-15)))}),keepAlive&&(clearTimeout(refreshLoginTimer),refreshLoginTimer=setTimeout(function(){tokenRefresh()},1e3*(session.lastTtl-15)))}(response),resolve()):(tokenHandleBadResponse(response),reject())},function(response){tokenHandleBadResponse(response),reject()})})}function tokenHandleBadResponse(response){"object"==typeof response&&Object.prototype.hasOwnProperty.call(response, "data")&&Object.prototype.hasOwnProperty.call(response.data, "errors")&&Object.prototype.hasOwnProperty.call(response.data.errors, "length")?console.error(response.data.errors):console.error(response)}function modelInjectProperty(modelDatas,properties){modelDatas.forEach(function(modelData){_.extend(modelData,properties)})}function compileOrderFilter(orderUnparsed){"string"==typeof orderUnparsed&&(orderUnparsed=orderUnparsed.split(","));let orderQuery=[];return orderUnparsed.forEach(function(orderName){let direction="ASC";"-"===orderName.charAt(0)&&(orderName=orderName.substring(1,orderName.length),direction="DESC"),orderQuery.push(orderName+" "+direction)}),orderQuery}function compilePropertyFilter(options){let skip=0;options.page&&(skip=(options.page-1)*options.perPage);let filterQuery={where:function(where){let whereQuery={};return Object.prototype.hasOwnProperty.call(where, "ListingKey")&&""!==where.ListingKey&&(whereQuery.ListingKey=where.ListingKey),Object.prototype.hasOwnProperty.call(where, "ListingType")&&""!==where.ListingType&&("string"==typeof where.ListingType&&(where.ListingType=[where.ListingType]),whereQuery.ListingType=where.ListingType),Object.prototype.hasOwnProperty.call(where, "Status")&&""!==where.Status&&("string"==typeof where.Status&&(where.Status=[where.Status]),whereQuery.Status={inq:where.Status}),Object.prototype.hasOwnProperty.call(where, "AgentLicense")&&""!==where.AgentLicense&&("string"==typeof where.AgentLicense&&(where.AgentLicense=[where.AgentLicense]),where.AgentLicense.length>0&&(whereQuery.AgentLicense=where.AgentLicense)),Object.prototype.hasOwnProperty.call(where, "City")&&""!==where.City&&(whereQuery.City={like:where.City,options:"i"}),Object.prototype.hasOwnProperty.call(where, "ListPriceMin")&&where.ListPriceMin&&0!==where.ListPriceMin&&(whereQuery.ListPrice={gte:parseInt(where.ListPriceMin,10)}),Object.prototype.hasOwnProperty.call(where, "ListPriceMax")&&where.ListPriceMax&&0!==where.ListPriceMax&&(Object.prototype.hasOwnProperty.call(whereQuery, "ListPrice")&&Object.prototype.hasOwnProperty.call(whereQuery.ListPrice, "gte")?whereQuery.ListPrice={between:[parseInt(where.ListPriceMin,10),parseInt(where.ListPriceMax,10)]}:whereQuery.ListPrice={lte:parseInt(where.ListPriceMax,10)}),Object.prototype.hasOwnProperty.call(where, "BathroomsFullMin")&&where.BathroomsFullMin&&0!==where.BathroomsFullMin&&(whereQuery.BathroomsFull={gte:parseInt(where.BathroomsFullMin,10)}),Object.prototype.hasOwnProperty.call(where, "BedroomsTotalMin")&&where.BedroomsTotalMin&&0!==where.BedroomsTotalMin&&(whereQuery.BedroomsTotal={gte:parseInt(where.BedroomsTotalMin,10)}),whereQuery}(options.where),fields:options.fields,limit:options.perPage,skip:skip};options.order&&options.order.length>0&&(filterQuery.order=compileOrderFilter(options.order));let includes=[];if(options.images){let imageInclude={relation:"Images",scope:{order:"Order",fields:["MediaURL"]}};"object"==typeof options.images&&(Object.prototype.hasOwnProperty.call(options.images, "limit")&&(imageInclude.scope.limit=options.images.limit),Object.prototype.hasOwnProperty.call(options.images, "fields")&&("*"===options.images.fields?delete imageInclude.scope.fields:imageInclude.scope.fields=options.images.fields)),includes.push(imageInclude)}if(options.openhouses){let openHouseInclude={relation:"OpenHouses",scope:{order:"OpenHouseStartTime",fields:["OpenHouseStartTime","OpenHouseEndTime"]}};"object"==typeof options.openhouses&&(Object.prototype.hasOwnProperty.call(options.openhouses, "limit")&&(openHouseInclude.scope.limit=options.openhouses.limit),Object.prototype.hasOwnProperty.call(options.openhouses, "fields")&&("*"===options.openhouses.fields?delete openHouseInclude.scope.fields:openHouseInclude.scope.fields=options.openhouses.fields)),includes.push(openHouseInclude)}return 1===includes.length?filterQuery.include=includes[0]:includes.length>1&&(filterQuery.include=includes),filterQuery.fields.length<=0&&delete filterQuery.fields,filterQuery}function compileMemberFilter(options){let skip=0;options.page&&(skip=(options.page-1)*options.perPage);let filterQuery={where:function(where){let whereQuery={};return Object.prototype.hasOwnProperty.call(where, "MemberKey")&&""!==where.MemberKey&&(whereQuery.MemberKey=where.MemberKey),Object.prototype.hasOwnProperty.call(where, "MemberStateLicense")&&""!==where.MemberStateLicense&&(whereQuery.MemberStateLicense=where.MemberStateLicense),Object.prototype.hasOwnProperty.call(where, "MemberNationalAssociationId")&&""!==where.MemberNationalAssociationId&&(whereQuery.MemberNationalAssociationId=where.MemberNationalAssociationId),Object.prototype.hasOwnProperty.call(where, "MemberStatus")&&""!==where.MemberStatus&&(whereQuery.MemberStatus=where.MemberStatus),Object.prototype.hasOwnProperty.call(where, "MemberFullName")&&""!==where.MemberFullName&&(whereQuery.MemberFullName={like:where.MemberFullName,options:"i"}),whereQuery}(options.where),fields:options.fields,limit:options.perPage,skip:skip};options.order&&options.order.length>0&&(filterQuery.order=compileOrderFilter(options.order));let includes=[];if(options.images){let imageInclude={relation:"Images",scope:{order:"Order",fields:["MediaURL"]}};"object"==typeof options.images&&(Object.prototype.hasOwnProperty.call(options.images, "limit")&&(imageInclude.scope.limit=options.images.limit),Object.prototype.hasOwnProperty.call(options.images, "fields")&&("*"===options.images.fields?delete imageInclude.scope.fields:imageInclude.scope.fields=options.images.fields)),includes.push(imageInclude)}if(options.office){let includeItem={relation:"Office",scope:{fields:["OfficeName","OfficeKey"]}};"object"==typeof options.office&&Object.prototype.hasOwnProperty.call(options.office, "fields")&&("*"===options.office.fields?delete includeItem.scope.fields:includeItem.scope.fields=options.office.fields),includes.push(includeItem)}return 1===includes.length?filterQuery.include=includes[0]:includes.length>1&&(filterQuery.include=includes),filterQuery.fields.length<=0&&delete filterQuery.fields,filterQuery}function compileOfficeFilter(options){let skip=0;options.page&&(skip=(options.page-1)*options.perPage);let filterQuery={where:function(where){let whereQuery={};return Object.prototype.hasOwnProperty.call(where, "OfficeKey")&&""!==where.OfficeKey&&(whereQuery.OfficeKey=where.OfficeKey),Object.prototype.hasOwnProperty.call(where, "OfficeNationalAssociationId")&&""!==where.OfficeNationalAssociationId&&(whereQuery.OfficeNationalAssociationId=where.OfficeNationalAssociationId),Object.prototype.hasOwnProperty.call(where, "OfficeStatus")&&""!==where.OfficeStatus&&(whereQuery.OfficeStatus=where.OfficeStatus),Object.prototype.hasOwnProperty.call(where, "OfficeName")&&""!==where.OfficeName&&(whereQuery.OfficeName={like:where.OfficeName,options:"i"}),whereQuery}(options.where),fields:options.fields,limit:options.perPage,skip:skip};options.order&&options.order.length>0&&(filterQuery.order=compileOrderFilter(options.order));let includes=[];if(options.images){let imageInclude={relation:"Images",scope:{order:"Order",fields:["MediaURL"]}};"object"==typeof options.images&&(Object.prototype.hasOwnProperty.call(options.images, "limit")&&(imageInclude.scope.limit=options.images.limit),Object.prototype.hasOwnProperty.call(options.images, "fields")&&("*"===options.images.fields?delete imageInclude.scope.fields:imageInclude.scope.fields=options.images.fields)),includes.push(imageInclude)}if(options.managingBroker){let includeItem={relation:"Member",scope:{fields:["MemberFullName","MemberStateLicense","MemberKey"]}};"object"==typeof options.managingBroker&&Object.prototype.hasOwnProperty.call(options.managingBroker, "fields")&&("*"===options.managingBroker.fields?delete includeItem.scope.fields:includeItem.scope.fields=options.managingBroker.fields),includes.push(includeItem)}if(options.members){let includeItem={relation:"Member",scope:{fields:["MemberFullName","MemberStateLicense","MemberKey"]}};"object"==typeof options.members&&Object.prototype.hasOwnProperty.call(options.members, "fields")&&("*"===options.members.fields?delete includeItem.scope.fields:includeItem.scope.fields=options.members.fields),includes.push(includeItem)}return 1===includes.length?filterQuery.include=includes[0]:includes.length>1&&(filterQuery.include=includes),filterQuery.fields.length<=0&&delete filterQuery.fields,filterQuery}function getUrlOptionsPath(defaultOptions){defaultOptions=defaultOptions||{};let path="",searchOptionNames=Object.keys(urlOptions.Search);if(searchOptionNames.length>0){let searchPath="";searchOptionNames.forEach(function(searchOptionName){Object.prototype.hasOwnProperty.call(urlOptions.Search, searchOptionName)&&null!==urlOptions.Search[searchOptionName]&&!_.isEqual(defaultOptions[searchOptionName],urlOptions.Search[searchOptionName])&&(searchPath+=searchOptionName+"/"+urlOptions.Search[searchOptionName]+"/")}),""!==searchPath&&(path+="Search/"+searchPath)}return Object.prototype.hasOwnProperty.call(urlOptions.Listing, "service")&&Object.prototype.hasOwnProperty.call(urlOptions.Listing, "ListingKey")&&!isNaN(urlOptions.Listing.service)&&urlOptions.Listing.ListingKey&&(path+="Listing/"+urlOptions.Listing.service+"/"+urlOptions.Listing.ListingKey+"/",Object.prototype.hasOwnProperty.call(urlOptions.Listing, "address")&&urlOptions.Listing.address&&"string"==typeof urlOptions.Listing.address&&(path+=urlOptions.Listing.address.replace(/ /g,"-")+"/")),path}async function genericSearchCollection($scope,collectionVarName,options,refresh,instanceName,apiModel,compileFilterFunction){(options=options||{}).service=options.service||[],options.where=options.where||{},options.order=options.order||[],options.page=options.page||1,options.perPage=options.perPage||10,options.images=options.images||!1,options.fields=options.fields||["_id"],refresh=refresh||!1,"string"==typeof options.order&&(options.order=options.order.split(","));let apiModelSingular="";switch(apiModel){case"Properties":apiModelSingular="Property";break;case"Members":apiModelSingular="Member";break;case"Offices":apiModelSingular="Office";break;case"OpenHouses":apiModelSingular="OpenHouse"}let collection=await function(instanceType,scopedCollectionVarName){let collection;return Object.keys(instance[instanceType]).forEach(function(listName){!collection&&Object.prototype.hasOwnProperty.call(instance[instanceType], listName)&&Object.prototype.hasOwnProperty.call(instance[instanceType][listName], scopedCollectionVarName)&&(collection=instance[instanceType][listName][scopedCollectionVarName])}),collection||(collection=new Collection),Object.keys(instance[instanceType]).forEach(function(listName){Object.prototype.hasOwnProperty.call(instance[instanceType][listName], scopedCollectionVarName)&&instance[instanceType][listName][scopedCollectionVarName]===collection||(instance[instanceType][listName][scopedCollectionVarName]=collection)},this),collection}(instanceName,collectionVarName),filterQuery=compileFilterFunction(options);const collections=[];if(!_.isEqual(lastQueries.whereFilter,filterQuery.where)||lastQueries.order!==options.order||lastQueries.perPage!==options.perPage||refresh?(collection.models.splice(0,collection.models.length),refresh=!0,lastQueries.pages=[],filterQuery.count=!0):refresh=!1,collection.models.length<options.page*options.perPage){if(options.page>1&&!lastQueries.pages.includes(options.page-1,options.page-2)){filterQuery.limit=options.perPage*options.page,filterQuery.skip=0;for(let addPage=1;addPage<options.page;addPage++)lastQueries.pages.push(addPage)}if(await tokenKeepAuth(),0===options.service.length&&(options.service=Object.keys(session.services)),options.service.forEach(function(serviceId){if(Object.prototype.hasOwnProperty.call(session.services, serviceId)){let request={serviceId:serviceId,urlRoot:session.services[serviceId].host,target:apiModel+"/search",api:{filter:filterQuery,meta:{method:"get",action:"search"},route:{controller:apiModelSingular}}};collections.push(function(request){request.direct=!0;let collection=new Collection(request);return request.api&&collection.meta.set("api",_.isJSON(request.api)?JSON.parse(request.api):request.api),collection}(request))}}),await async function(originalCollection,collections,append){originalCollection.pending=!0,originalCollection.completed=!1;let totalCount=0;const fetchPromises=[];return collections.forEach(function(collection){let options={};null!==session.services[collection.serviceId].token&&(options.headers={Authorization:session.services[collection.serviceId].token}),fetchPromises.push($q(function(resolve,reject){collection.fetch("POST",null,options).then(function(models){resolve(models)}).then(function(){resolve(modelInjectProperty(collection.models,{_ServiceId:collection.serviceId}))}).then(function(){let countRecords=collection.header.get("x-total-count");countRecords&&(totalCount+=parseInt(countRecords))})}))}),append||originalCollection.models.splice(0,originalCollection.models.length),$q.all(fetchPromises).then(function(fetchedData){return fetchedData.forEach(function(models){_.isArray(models)&&originalCollection.models.push(...models)}),originalCollection}).then(function(){return originalCollection.header.set("x-total-count",totalCount),originalCollection.meta.set("fetchDate",new Date),originalCollection.pending=!1,originalCollection.completed=!0,originalCollection.filtering=!1,originalCollection.paginate=!1,originalCollection})}(collection,collections,!refresh),refresh){let totalRecords=collection.header.get("x-total-count")||0;collection.meta.set("totalRecords",totalRecords),collection.meta.set("totalPages",Math.ceil(totalRecords/options.perPage))}!function(collection,propertyNames,reverse){propertyNames&&propertyNames!==[]&&(collection.models=orderByFilter(collection.models,propertyNames,reverse))}(collection,options.order),Object.keys(instance[instanceName]).forEach(function(listName){instance[instanceName][listName].$applyAsync()})}return lastQueries.whereFilter=_.clone(filterQuery.where),lastQueries.order=options.order,lastQueries.perPage=options.perPage,lastQueries.pages.push(options.page),collection}async function genericSearchModel($scope,modelVarName,options,apiModel,compileFilterFunction){await tokenKeepAuth();let model,apiModelSingular="";switch(apiModel){case"Properties":apiModelSingular="Property";break;case"Members":apiModelSingular="Member";break;case"Offices":apiModelSingular="Office";break;case"OpenHouses":apiModelSingular="OpenHouse"}if((options=options||{}).service=options.service||0,options.where=options.where||{},options.images=options.images||!1,options.fields=options.fields||[],options.perPage=1,Object.prototype.hasOwnProperty.call($scope, modelVarName)&&(model=$scope[modelVarName]),model||(model=new Model),Object.prototype.hasOwnProperty.call($scope, modelVarName)&&$scope[modelVarName]===model||($scope[modelVarName]=model),Object.prototype.hasOwnProperty.call(session.services, options.service)){(function(originalModel,newModel){originalModel.pending=!0,originalModel.completed=!1;const fetchPromises=[];let options={};return null!==session.services[newModel.serviceId].token&&(options.headers={Authorization:session.services[newModel.serviceId].token}),fetchPromises.push($q(function(resolve,reject){console.log("sending fetchReplaceModel",newModel,options),newModel.fetch("POST",null,options).then(function(data){resolve(data)}).then(function(){resolve(modelInjectProperty([newModel.data],{_ServiceId:newModel.serviceId}))})})),$q.all(fetchPromises).then(function(fetchedData){return fetchedData.forEach(function(data){originalModel.data=data}),originalModel}).then(function(){return originalModel.meta.set("fetchDate",new Date),originalModel.pending=!1,originalModel.completed=!0,originalModel})})(model,function(request){let model=new Model(request);return request.api&&model.meta.set("api",_.isJSON(request.api)?JSON.parse(request.api):request.api),model}({serviceId:options.service,urlRoot:session.services[options.service].host,target:apiModel+"/search",api:{filter:compileFilterFunction(options),meta:{method:"get",action:"search"},route:{controller:apiModelSingular}}})).then(function(){$scope.$applyAsync()})}return $scope[modelVarName]}return{fetchMembers:async function($scope,collectionVarName,options,refresh){return(options=options||{}).service=options.service||[],options.listName=options.listName||"MemberList",options.where=options.where||{},options.order=options.order||[],options.page=options.page||1,options.perPage=options.perPage||10,options.images=options.images||!1,options.office=options.office||!1,options.fields=options.fields||["_id","MemberKey","MemberStateLicense","MemberNationalAssociationId","MemberFirstName","MemberLastName","MemberFullName","MemberStatus","MemberMlsAccessYN","MemberType","OfficeKey","OfficeName","OriginatingSystemName","SourceSystemName"],refresh=refresh||!1,await genericSearchCollection(0,collectionVarName,options,refresh,options.listName,"Members",compileMemberFilter)},fetchOffices:async function($scope,collectionVarName,options,refresh){return(options=options||{}).service=options.service||[],options.where=options.where||{},options.order=options.order||[],options.page=options.page||1,options.perPage=options.perPage||10,options.images=options.images||!1,options.managingBroker=options.managingBroker||!1,options.members=options.members||!1,options.fields=options.fields||["_id","OfficeKey","OfficeName","OfficeNationalAssociationId","OfficeStatus","OfficePhone","OfficeAddress1","OfficePostalCode","OfficeBrokerKey"],refresh=refresh||!1,await genericSearchCollection(0,collectionVarName,options,refresh,"OfficeList","Offices",compileOfficeFilter)},fetchProperties:async function($scope,collectionVarName,options,refresh){return(options=options||{}).service=options.service||[],options.where=options.where||urlOptions.Search||{},options.order=options.order||urlOptions.Search.Order||[],options.page=options.page||urlOptions.Search.Page||1,options.perPage=options.perPage||10,options.images=options.images||!1,options.fields=options.fields||["_id","_Class","MlsStatus","PropertyType","PropertySubType","UnparsedAddress","StreetNumberNumeric","StreetName","StreetSuffix","UnitNumber","City","CountyOrParish","StateOrProvince","ListPrice","ClosePrice","ListingId","ListingKey","BathroomsFull","BedroomsTotal"],refresh=refresh||!1,await genericSearchCollection(0,collectionVarName,options,refresh,"List","Properties",compilePropertyFilter)},fetchProperty:async function($scope,modelVarName,options){return(options=options||{}).service=options.service||null,options.where=options.where||{},options.images=options.images||!1,options.openhouses=options.openhouses||!1,options.fields=options.fields||[],genericSearchModel($scope,modelVarName,options,"Properties",compilePropertyFilter)},getListInstance:function(listUid,listType){return"Property"===(listType=listType||"")&&(listType=""),Object.prototype.hasOwnProperty.call(instanceLink.List, listUid)?instance[listType+"List"][listUid]:null},getListInstanceLinks:function(listUid,listType){"Property"===(listType=listType||"")&&(listType="");let linkedSearches=[];return Object.prototype.hasOwnProperty.call(instanceLink.List, listUid)&&instanceLink.List[listUid].forEach(function(searchUid){Object.prototype.hasOwnProperty.call(instance[listType+"Search"], searchUid)&&linkedSearches.push(instance[listType+"Search"][searchUid])}),linkedSearches},getSearchInstanceLinks:function(searchUid,listType){"Property"===(listType=listType||"")&&(listType="");let linkedLists=[];return Object.prototype.hasOwnProperty.call(instanceLink.Search, searchUid)&&instanceLink.Search[searchUid].forEach(function(listUid){Object.prototype.hasOwnProperty.call(instance[listType+"List"], listUid)&&linkedLists.push(instance[listType+"List"][listUid])}),linkedLists},getUrlOptionsPath:getUrlOptionsPath,getMLSVariables:function(serviceIds){let serviceList=[];return serviceIds&&_.isArray(serviceIds)?serviceIds.forEach(function(service){Object.prototype.hasOwnProperty.call(session.services, service)&&(serviceList[session.services[service].id]={id:session.services[service].id,name:session.services[service].name,disclaimer:session.services[service].disclaimer})}):session.services.forEach(function(service){serviceList[service.id]={id:service.id,name:service.name,disclaimer:service.disclaimer}}),serviceList},getOptionsFromUrl:function(){let path=$location.path();return function(path){let regex=/\/Search\/(.*)?\/?/,matches=regex.exec(path);if(path=path.replace(regex,""),null!==matches&&matches[1]){let rawSearchOptions=matches[1];for(regex=/([^\/]+)\/([^\/]+)/g;null!=(matches=regex.exec(rawSearchOptions));)matches[1]&&matches[2]&&(matches[2].includes(",")&&(matches[2]=matches[2].split(",")),urlOptions.Search[matches[1]]=matches[2])}Object.prototype.hasOwnProperty.call(urlOptions.Search, "Page")&&(urlOptions.Search.Page=parseInt(urlOptions.Search.Page))}(path=function(path){let regex=/\/Listing\/(\d+?)\/(.*?)\/([\w-_]*)?\/?/,matches=regex.exec(path);return path=path.replace(regex,""),null!==matches&&matches[1]&&matches[2]&&(urlOptions.Listing.service=matches[1],urlOptions.Listing.ListingKey=matches[2]),path}(path)),urlOptions},getUrlOptions:function(listingOrSearch){return urlOptions[listingOrSearch]},tokenKeepAuth:tokenKeepAuth,registerListInstance:function(uid,$scope,listType){"Property"===(listType=listType||"")&&(listType=""),instance[listType+"List"]||(instance[listType+"List"]={}),instance[listType+"List"][uid]=$scope,Object.prototype.hasOwnProperty.call(instanceLink.List, uid)||(instanceLink.List[uid]=[])},registerSearchInstance:function(uid,$scope,listUid,listType){"Property"===(listType=listType||"")&&(listType=""),instance[listType+"Search"][uid]=$scope,Object.prototype.hasOwnProperty.call(instanceLink.Search, uid)||(instanceLink.Search[uid]=[]),listUid&&(instanceLink.Search[uid].push(listUid),Object.prototype.hasOwnProperty.call(instanceLink.List, listUid)||(instanceLink.List[listUid]=[]),instanceLink.List[listUid].push(uid))},registerDetailsInstance:function(uid,$scope){instance.Details[uid]=$scope},setPageTitle:function(title){defaultPageTitle||(defaultPageTitle=JSON.parse(JSON.stringify($window.document.title))),$window.document.title=title||defaultPageTitle},setTokenURL:function(url){tokenRefreshURL=url},setUrlOptions:function(listingOrSearch,options){urlOptions[listingOrSearch]=options||{}},refreshUrlOptions:function(defaultOptions){var path;path=getUrlOptionsPath(defaultOptions),$rootScope.$applyAsync(function(){$location.path(path).replace()})},unregisterDetailsInstance:function(uid){if(Object.prototype.hasOwnProperty.call(instance.Details, uid)){let detailUid=instance.Details[uid].getUid();delete instance.Details[uid],Stratus.Instances.Clean(detailUid)}}}}])}]});
