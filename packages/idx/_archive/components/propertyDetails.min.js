!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","lodash","angular","moment","angular-sanitize","stratus.services.idx","stratus.filters.math","stratus.filters.moment","stratus.components.carousel","stratus.components.propertyDetailsSubSection"],factory):factory(root.Stratus,root._,root.angular,root.moment)}(this,function(Stratus,_,angular,moment){const min=Stratus.Environment.get("production")?".min":"";Stratus.Components.PropertyDetails={bindings:{elementId:"@",urlLoad:"@",pageTitle:"@",service:"@",listingKey:"@",listingId:"@",images:"@",openhouses:"@",googleApiKey:"@",options:"@",template:"@",defaultListOptions:"@"},controller:["$scope","$attrs","$sce","$location","Model","Idx",function($scope,$attrs,$sce,$location,Model,Idx){const $ctrl=this;$ctrl.uid=_.uniqueId("property_details_"),Stratus.Instances[$ctrl.uid]=$scope,$scope.elementId=$attrs.elementId||$ctrl.uid,Stratus.Internals.CssLoader(Stratus.BaseUrl+"content/property/stratus/components/"+($attrs.template||"propertyDetails")+min+".css"),$ctrl.$onInit=function(){if($scope.model=new Model,$scope.options=$attrs.options&&_.isJSON($attrs.options)?JSON.parse($attrs.options):{},$scope.options.urlLoad=!$attrs.urlLoad||!_.isJSON($attrs.urlLoad)||JSON.parse($attrs.urlLoad),$scope.options.pageTitle=!(!$attrs.pageTitle||!_.isJSON($attrs.pageTitle))&&JSON.parse($attrs.pageTitle),$scope.options.service=$attrs.service&&_.isJSON($attrs.service)?JSON.parse($attrs.service):null,$scope.options.ListingKey=$attrs.listingKey&&_.isJSON($attrs.listingKey)?JSON.parse($attrs.listingKey):null,$scope.options.ListingId=$attrs.listingId&&_.isJSON($attrs.listingId)?JSON.parse($attrs.listingId):null,$scope.options.images=$attrs.images&&_.isJSON($attrs.images)?JSON.parse($attrs.images):{fields:["Order","MediaURL","LongDescription"]},$scope.options.openhouses=$attrs.openhouses&&_.isJSON($attrs.openhouses)?JSON.parse($attrs.openhouses):{fields:"*"},$scope.googleApiKey=$attrs.googleApiKey||null,$scope.defaultListOptions=$attrs.defaultListOptions&&_.isJSON($attrs.defaultListOptions)?JSON.parse($attrs.defaultListOptions):{},$scope.minorDetails=[{section:"Location",items:{UnitNumber:"Unit",City:"City",CityRegion:"City Region",Township:"Township",CountyOrParish:"County",MLSAreaMajor:"Area",SubdivisionName:"Subdivision",StateOrProvince:"State",StateRegion:"State Region",PostalCode:"Postal Code",Country:"Country"}},{section:"Business",items:{BusinessName:"Business Name",BusinessType:"Type",OwnershipType:"Ownership",SeatingCapacity:{name:"Seating Capacity",comma:!0},YearEstablished:"Year Established",YearsCurrentOwner:{name:"Years with Current Owner",comma:!0},HoursDaysOfOperation:"Hours Of Operation",HoursDaysOfOperationDescription:"Hours Of Operation",NumberOfFullTimeEmployees:{name:"Full-Time Employees",comma:!0},NumberOfPartTimeEmployees:{name:"Part-Time Employees",comma:!0},LaborInformation:"Labor Info",SpecialLicenses:"SpecialLicenses",LeaseAmount:{name:"LeaseAmount",prepend:"$",comma:!0},LeaseAmountFrequency:"Lease Frequency",LeaseAssignableYN:{true:"Lease Assignable",false:""},LeaseExpiration:"Lease Expiration",LeaseRenewalOptionYN:{true:"Lease Renewable",false:""}}},{section:"Listing",items:{SeniorCommunityYN:{true:"Senior Community",false:""},CommunityFeatures:"Community",CurrentUse:"Current Use",PossibleUse:"Possible Uses",LotFeatures:"Lot Features",LotSizeAcres:{name:"Lot Size",append:" Acres",comma:!0},LotSizeSquareFeet:{name:"Lot Size",append:" SqFt",comma:!0},LotSizeArea:{name:"Lot Size",comma:!0},LotSizeDimensions:"LotSizeDimensions",NumberOfBuildings:{name:"Number of Buildings",comma:!0},NumberOfLots:{name:"Number of Lots",comma:!0},NumberOfPads:{name:"Number of Pads",comma:!0},NumberOfUnitsInCommunity:{name:"Number of Units In Community",comma:!0},NumberOfUnitsTotal:{name:"Number of Units",comma:!0},UnitsFurnished:"Units Furnished",ViewYN:{true:"Has a View",false:""},View:"View",WaterfrontYN:{true:"Has a Waterfront",false:""},WaterfrontFeatures:"Waterfront",WaterBodyName:"Body of Water Name"}},{section:"Farming",items:{CropsIncludedYN:{true:"Crops Included",false:""},Vegetation:"Vegetation",FarmCreditServiceInclYN:{true:"Farm Credit Service Shares Included",false:""},GrazingPermitsBlmYN:{true:"Grazing Permitted - BLM",false:""},GrazingPermitsForestServiceYN:{true:"Grazing Permitted - Forestry Service",false:""},GrazingPermitsPrivateYN:{true:"Private Grazing Permitted",false:""},CultivatedArea:{name:"Cultivated Area",comma:!0},PastureArea:{name:"Pasture Area",comma:!0},RangeArea:{name:"Range Area",comma:!0},WoodedArea:{name:"Wooded Area",comma:!0}}},{section:"Interior",items:{Furnished:"Furnished",RoomsTotal:"# of Rooms",BedroomsTotal:"Bedrooms",BedroomsPossible:"Possible Bedrooms",MainLevelBedrooms:"Main Bedrooms",BathroomsTotalInteger:"Total Bathrooms",BathroomsFull:"Full Bathrooms",BathroomsPartial:"Partial Bathrooms",BathroomsOneQuarter:"1/4 Bathrooms",BathroomsHalf:"Half Bathrooms",BathroomsThreeQuarter:"3/4 Bathrooms",MainLevelBathrooms:"Main Bathrooms",Flooring:"Flooring",WindowFeatures:"Windows",DoorFeatures:"DoorFeatures",LivingArea:{name:"Living Area",comma:!0},FireplaceYN:{true:"Has Fireplace",false:""},FireplacesTotal:"# of Fireplaces",FireplaceFeatures:"Fireplace",InteriorFeatures:"Interior Features",Appliances:"Appliances",SecurityFeatures:"Security",OtherEquipment:"Equipment"}},{section:"Exterior",items:{ExteriorFeatures:"Exterior",PatioAndPorchFeatures:"Patio And Porch",Fencing:"Fencing",Topography:"Topography",FrontageType:"Frontage",FrontageLength:"Frontage Length"}},{section:"Amenities",items:{HorseYN:{true:"Horse Property",false:""},HorseAmenities:"Horse Amenities",PoolPrivateYN:{true:"Has Private Pool",false:""},PoolFeatures:"Pool",SpaYN:{true:"Has Spa",false:""},SpaFeatures:"Spa",LaundryFeatures:"Laundry"}},{section:"Heating & Cooling",items:{CoolingYN:{true:"Has Cooling",false:""},Cooling:"Cooling",HeatingYN:{true:"Has Heating",false:""},Heating:"Heating"}},{section:"Structure",items:{NewConstructionYN:{true:"New Construction",false:""},DevelopmentStatus:"Development Status",StructureType:"Type",ArchitecturalStyle:"Style",PropertyCondition:"Condition",PropertyAttachedYN:{true:"Property Attached to Existing Structure",false:""},Stories:"Stories",MobileHomeRemainsYN:{true:"Mobile Home Remains",false:""},Make:"Make",Model:"Model",BodyType:"Body Type",MobileLength:{name:"Mobile Length",comma:!0},MobileWidth:{name:"Mobile Width",comma:!0},BuildingName:"Building Name",StoriesTotal:"Complex Stories",BuilderModel:"Model",BuilderName:"Builder",YearBuilt:"Year Built",YearBuiltEffective:"Year Renovated",YearBuiltDetails:{},CommonWalls:"Common Walls",BuildingFeatures:"Building Features",AccessibilityFeatures:"Accessibility",Basement:"Basement",Roof:"Roof",ConstructionMaterials:"Construction",FoundationDetails:"Foundation",FoundationArea:"Foundation",OtherStructures:"Other Structures",BuildingAreaTotal:{name:"Building Area",comma:!0},DOH1:"DOH1",DOH2:"DOH2",DOH3:"DOH3",License1:"License",License2:"License",License3:"License",RVParkingDimensions:"RV Parking",SerialU:"Serial U",SerialX:"Serial X",SerialXX:"Serial XX",Skirt:"Skirt"}},{section:"Parking",items:{ParkingTotal:"Parking Spaces",GarageYN:{true:"Has Garage",false:""},GarageSpaces:"# of Garage Spaces",AttachedGarageYN:{true:"Attached Garage",false:""},CarportYN:{true:"Has Carport",false:""},CarportSpaces:"# of Carport Spaces",CoveredSpaces:"# of Covered Spaces",OpenParkingSpaces:"# of Open Spaces",OtherParking:"Other Parking",ParkingFeatures:"Parking"}},{section:"Utilities",items:{Utilities:"Utilities",Electric:"Electric",WaterSource:"Water",Sewer:"Sewer",IrrigationSource:"IrrigationSource",IrrigationWaterRightsYN:{true:"Has Irrigation Water Rights",false:""},IrrigationWaterRightsAcres:{name:"Irrigation Water Rights",append:" Acres",comma:!0},NumberOfSeparateElectricMeters:{name:"Number Of Separate Electric Meters",comma:!0},NumberOfSeparateGasMeters:{name:"Number Of Separate Gas Meters",comma:!0},NumberOfSeparateWaterMeters:{name:"Number Of Separate Water Meters",comma:!0}}},{section:"School",items:{ElementarySchool:"Elementary School",ElementarySchoolDistrict:"Elementary School District",MiddleOrJuniorSchool:"Middle School",MiddleOrJuniorSchoolDistrict:"Middle School District",HighSchoolt:"High School",HighSchoolDistrict:"High School District"}},{section:"Contract",items:{AvailabilityDate:"Availability",PetsAllowed:{name:"PetsAllowed"},HomeWarrantyYN:{true:"Home Warranty Included",false:""},LeaseConsideredYN:{true:"Leasing Considered",false:""},ListingAgreement:"Listing Agreement",ListingService:"Service",DocumentsAvailable:"Documents Available",Ownership:"Ownership",Contingencies:"Contingencies",Disclosures:"Disclosures",Exclusions:"Exclusions",Inclusions:"Inclusions",ListingTerms:"ListingTerms",SpecialListingConditions:"Special Listing Conditions",CommonInterest:"Common Interest",CopyrightNotice:"Copyright Notice",Disclaimer:"Disclaimer"}},{section:"Financial",items:{RentControlYN:{true:"Rent Control",false:""},TenantPays:"Tenant Pays",OwnerPays:"Owner Pays",RentIncludes:"Rent Includes",AssociationYN:{true:"Has HOA",false:"No HOA"},AssociationFee:{name:"HOA Fee",prepend:"$",comma:!0},AssociationFeeFrequency:"HOA Frequency",AssociationFeeIncludes:"HOA Includes",AssociationFee2:{name:"Additional HOA Fee",prepend:"$",comma:!0},AssociationFeeFrequency2:"Additional HOA Frequency",CableTvExpense:{name:"Cable Tv Expense",prepend:"$",comma:!0},ElectricExpense:{name:"Electric Expense",prepend:"$",comma:!0},FuelExpense:{name:"Fuel Expense",prepend:"$",comma:!0},FurnitureReplacementExpense:{name:"Furniture Replacement Expense",prepend:"$",comma:!0},GardenerExpense:{name:"Gardener Expense",prepend:"$",comma:!0},InsuranceExpense:{name:"Insurance Expense",prepend:"$",comma:!0},LicensesExpense:{name:"Licenses Expense",prepend:"$",comma:!0},MaintenanceExpense:{name:"Maintenance Expense",prepend:"$",comma:!0},ManagerExpense:{name:"Manager Expense",prepend:"$",comma:!0},NewTaxesExpense:{name:"New Taxes Expense",prepend:"$",comma:!0},OperatingExpense:{name:"Operating Expense",prepend:"$",comma:!0},OperatingExpenseIncludes:"Operating Expense Includes",OtherExpense:{name:"Other Expense",prepend:"$",comma:!0},PestControlExpense:{name:"Pest Control Expense",prepend:"$",comma:!0},PoolExpense:{name:"Pool Expense",prepend:"$",comma:!0},ProfessionalManagementExpense:{name:"Professional Management Expense",prepend:"$",comma:!0},SuppliesExpense:{name:"Supplies Expense",prepend:"$",comma:!0},TrashExpense:{name:"Trash Expense",prepend:"$",comma:!0},WaterSewerExpense:{name:"Water Sewer Expense",prepend:"$",comma:!0},WorkmansCompensationExpense:{name:"Workmans Compensation Expense",prepend:"$",comma:!0},TaxAnnualAmount:{name:"Annual Tax",prepend:"$",comma:!0},TaxOtherAnnualAssessmentAmount:{name:"Other Annual Tax",prepend:"$",comma:!0},TaxAssessedValue:{name:"Tax Assessed Value",prepend:"$",comma:!0},TaxYear:"Tax Year Assessed",TaxStatusCurrent:"Tax Status",TaxParcelLetter:"Tax Parcel Letter",ParcelNumber:"Parcel Number",AdditionalParcelsYN:{true:"Has Additional Prcels",false:""},AdditionalParcelsDescription:"Parcels",Zoning:"Zoning",ZoningDescription:"Zoning"}},{section:"Sources",items:{FinancialDataSource:"Financial Data",LotSizeSource:"Lot Size",LotDimensionsSource:"Lot Dimensions",LivingAreaSource:"Living Area",BuildingAreaSource:"Building Area",FarmLandAreaSource:"Farm Land Area",YearBuiltSource:"Year Built",MapCoordinateSource:"Map Coordinate",ListAOR:{name:"Listing AOR"},OriginatingSystemName:{name:"Originating System"},OriginatingSystemKey:{name:"Originating System",prepend:"# "}}}],Idx.registerDetailsInstance($scope.elementId,$scope),!0!==$scope.urlLoad&&$scope.service&&($scope.ListingKey||$scope.ListingId)?$scope.urlLoad=!1:$scope.urlLoad=!0,$scope.urlLoad){const urlOptions=Idx.getOptionsFromUrl();Object.prototype.hasOwnProperty.call(urlOptions,"Listing")&&_.extend($scope.options,urlOptions.Listing)}$scope.fetchProperty()},$scope.$watch("model.data",function(data){data&&($scope.devLog("Loaded Details Data:",data),Idx.setUrlOptions("Listing",{service:$scope.options.service,ListingKey:data.ListingKey,address:$scope.getStreetAddress()}),Idx.refreshUrlOptions($scope.defaultListOptions),$scope.options.pageTitle&&Idx.setPageTitle(data.UnparsedAddress))}),$scope.getUid=function(){return $ctrl.uid},$scope.fetchProperty=function(){const propertyQuery={service:$scope.options.service,where:{}};$scope.options.ListingKey?propertyQuery.where.ListingKey=$scope.options.ListingKey:$scope.options.ListingId&&(propertyQuery.where.ListingId=$scope.options.ListingId),$scope.options.images&&(propertyQuery.images=$scope.options.images),$scope.options.openhouses&&(propertyQuery.openhouses=$scope.options.openhouses),isNaN(propertyQuery.service)||!propertyQuery.where.ListingKey&&!propertyQuery.where.ListingId?console.error("No Service Id or Listing Key/Id is fetch from"):Idx.fetchProperty($scope,"model",propertyQuery)},$scope.getSlideshowImages=function(){const images=[];return $scope.model.data.Images.forEach(function(image){Object.prototype.hasOwnProperty.call(image,"MediaURL")&&images.push({src:image.MediaURL})}),images},$scope.getStreetAddress=function(){let address="";if(Object.prototype.hasOwnProperty.call($scope.model.data,"UnparsedAddress")&&""!==$scope.model.data.UnparsedAddress)address=$scope.model.data.UnparsedAddress;else{const addressParts=[];["StreetNumberNumeric","StreetName","StreetSuffix","UnitNumber"].forEach(function(addressPart){Object.prototype.hasOwnProperty.call($scope.model.data,addressPart)&&("UnitNumber"===addressPart&&addressParts.push("Unit"),addressParts.push($scope.model.data[addressPart]))}),address=addressParts.join(" ")}return address},$scope.getFullAddress=function(encode){const address=$scope.model.data.UnparsedAddress+", "+$scope.model.data.City+" "+$scope.model.data.StateOrProvince;return encode?encodeURIComponent(address):address},$scope.getListAgentName=function(){return $scope.model.data.ListAgentFullName||($scope.model.data.ListAgentFirstName?$scope.model.data.ListAgentFirstName+" "+$scope.model.data.ListAgentLastName:null)},$scope.getCoListAgentName=function(){return $scope.model.data.CoListAgentFullName||($scope.model.data.CoListAgentFirstName?$scope.model.data.CoListAgentFirstName+" "+$scope.model.data.CoListAgentLastName:null)},$scope.getBuyerAgentName=function(){return $scope.model.data.BuyerAgentFullName||($scope.model.data.BuyerAgentFirstName?$scope.model.data.BuyerAgentFirstName+" "+$scope.model.data.BuyerAgentLastName:null)},$scope.getCoBuyerAgentName=function(){return $scope.model.data.CoBuyerAgentFullName||($scope.model.data.CoBuyerAgentFirstName?$scope.model.data.CoBuyerAgentFirstName+" "+$scope.model.data.CoBuyerAgentLastName:null)},$scope.getGoogleMapEmbedUrl=function(){return $scope.googleApiKey?$sce.trustAsResourceUrl("https://www.google.com/maps/embed/v1/place?key="+$scope.googleApiKey+"=&q="+$scope.getFullAddress(!0)):null},$scope.getMLSVariables=function(){return $ctrl.mlsVariables||($ctrl.mlsVariables=Idx.getMLSVariables([$scope.model.data._ServiceId])),$ctrl.mlsVariables[$scope.model.data._ServiceId]},$scope.getMLSName=function(){return $scope.getMLSVariables().name},$scope.processMLSDisclaimer=function(html){let disclaimer=$scope.getMLSVariables().disclaimer;return $scope.model.data.ModificationTimestamp&&(disclaimer=`Listing last updated ${moment($scope.model.data.ModificationTimestamp).format("M/D/YY HH:mm a")}. ${disclaimer}`),$scope.model.meta.data.fetchDate&&(disclaimer=`Last checked ${moment($scope.model.meta.data.fetchDate).format("M/D/YY")}. ${disclaimer}`),html?$sce.trustAsHtml(disclaimer):disclaimer},$scope.getMLSDisclaimer=function(html){return $ctrl.disclaimerHTML||($ctrl.disclaimerHTML=$scope.processMLSDisclaimer(!0)),$ctrl.disclaimerString||($ctrl.disclaimerString=$scope.processMLSDisclaimer(!1)),html?$ctrl.disclaimerHTML:$ctrl.disclaimerString},$scope.remove=function(){},$scope.devLog=function(item1,item2){Stratus.Environment.get("production")||console.log(item1,item2)}}],templateUrl:function($element,$attrs){return Stratus.BaseUrl+"content/property/stratus/components/"+($attrs.template||"propertyDetails")+min+".html"}}});